{% extends 'base.html' %} {% load static %} {% block content %}
<header>
    <div class="container wrapper">
        <h1>
            <a href="#">
                <img
                    src="{% static  '../static/images/logo.svg' %}"
                    alt="Logo"
                />
            </a>
        </h1>
        <div class="right">
            <div class="userDetails">
                <div class="userImage">
                    {% if current_user.employee.profile_image %}
                        <img src="{{ current_user.employee.profile_image.url }}" alt="User Image">
                    {% else %}
                        <img src="{% static 'images/user-image.png' %}" alt="Default User Image">
                    {% endif %}
                </div>
                <p class="userName">{{ current_user }}</p>
                <div class="arrow">
                    <!-- <img
                        src="{% static '../static/images/dropdown.svg' %}"
                        alt=""
                    /> -->
                </div>
            </div>
        </div>
    </div>
</header>

<div id="updateModalContainer" class="updateModal">
    <form 
        id="update-modal"
        method="post"
        class="update-content"
    >
        {%csrf_token%}
        <div class="closeIcon" id="updateClose">
            <img
                src="{% static '../static/images/Close.svg' %}"
                alt="close icon"
            />
        </div>
        <h4>Project updating</h4>
        <div class="twoField">
            <div class="field">
                <label for="projectName">Project name</label>
                <input
                    type="text"
                    placeholder="Updated by"
                    id="project-name-input"
                />
            </div>
            <div class="field">
                <label for="projectName">Priority</label>
                <input
                    type="text"
                    placeholder="Updated by"
                    id="priority-input"
                />
            </div>
        </div>

        <div class="field">
            <label for="projectName">Update Description</label>
            <textarea
                type="text"
                placeholder="Add description..."
                class="textField"
                rows="3"
                name="description"
                id="description-input"
            ></textarea
            >
        </div>
        
        <div class="field">
            <label for="progress-input">Select progress</label>
            <span class="dropDownList"
                >
                <select id="progress-input" name="project_status"
                >
                    <option value="on_progress">On progress</option>
                    <option value="completed">Completed</option>
                    <option value="to_do">To do</option>
                    <option value="over_due">Overdue</option>
                </select>
            </span>
        </div>
        <div class="updateButtons">
            <button class="updateClose" id="updateCancel" type="button">cancel</button>
            <button class="updateCreate" type="update" id="UpdateSave">Update</button>
        </div>
    </form>
</div>

<div id="logoutModal" class="logoutModal">
    <form class="logoutModal-content" action="{% url 'logout_user' %}" method="POST">
        {% csrf_token %}
        <h4>Logout</h4>
        <p>Are you sure want to logout ?</p>
        <div class="createButtons">
            <button class="close" id="logoutcancel" type="button">cancel</button>
            <button class="create" id="logoutsave">Logout</button>
        </div>
    </form>
</div>


<div id="container">
    <nav>
        <ul>
            <li class="nav-item">
                <a href="/employee/dashboard"
                    ><div class="icon">
                        <img
                            src="{% static 'images/dark-dashboard-icon.svg' %}"
                            alt="Dashboard Icon"
                        />
                    </div>
                    Dashboard</a
                >
            </li>
            <li class="nav-item">
                <a href="/employee/projects?status=all"
                    ><div class="icon">
                        <img
                            src="{% static 'images/dark-project-icon.svg' %}"
                            alt="Project Icon"
                        />
                    </div>
                    Tasks</a
                >
            </li>
            <li class="nav-item active">
                <a href="{% url 'employee_meeting' %}"
                    ><div class="icon">
                        <img
                            src="{% static '/images/white-meeting-icon.svg' %}"
                            alt="Project Icon"
                        />
                    </div>
                    Meetings</a
                >
            </li>
        </ul>
        <div class="logout" id="logoutButton">
            <a href="#"
                ><div class="icon">
                    <img
                        src="{% static 'images/dark-logout-icon.svg' %}"
                        alt="Logout Icon"
                    />
                </div>
                Logout
            </a>
        </div>
    </nav>
    <div class="content">
<section id="employeeProject">
    <h4>Meetings</h4>
    <div class="projects">
        <table class="tableStyle projectTableStyle" id="meetingTable">
            <thead>
                <th>SI NO</th>
                <th>Employee name</th>
                <th class="centre">Time</th>
                <th class="right">Link</th>
            </thead>
            <tbody>
                {% for meeting in meetings %}
                <tr id="{{ meeting.id }}" class="preventClick">
                    <td>{{ forloop.counter }}</td>
                    <td>{{ meeting.employee.name }}</td>
                    <td class="centre">{{ meeting.meet_date|date:"d/m/Y h:i A" }}</td>
                    <td class="right"><a href="{{ meeting.link }}">{{ meeting.link }}</a></td>
                    
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="paginationContainer">
            <div class="text">Showing 1 to 10 Meetings</div>
            <div class="paginationNav">
                <button id="prevBtn">&lt;</button>
                <div id="pagination" class="pagination"></div>
                <button id="nextBtn">&gt;</button> 
            </div>
        </div>
    </div>
</section>
</div>
</div>
<script>
    const logoutModal = document.getElementById("logoutModal");
    const logoutButton = document.getElementById("logoutButton");
    const logoutSave = document.getElementById("logoutsave");
    const logoutCancel = document.getElementById("logoutcancel");

    logoutButton.onclick = () => {
        logoutModal.style.display = "block";
    }

    logoutCancel.onclick = () => {
        logoutModal.style.display = "none";
    };

    logoutSave.onclick = () => {
        logoutModal.style.display = "none";
        window.location.href = "/";
    };

    //active class
    
    // const listItems = document.querySelectorAll("#employeeProject ul li");
    // listItems.forEach(item => {
    //     item.addEventListener("click", handleListItemClick);
    // });

    const listStatus = document.querySelectorAll(".status");

    const params = new URLSearchParams(location.search);

    listStatus.forEach((item) => {
        const status = item.getAttribute("data-slug");

        if (status == params.get("status")) {
            item.classList.add("active");
        } else {
            item.classList.remove("active");
        }
    });

    const priorityColor = document.querySelectorAll(".priorityChoice");

    priorityColor.forEach((item)=>{
        const priorityColorValue = item.getAttribute("data-priority");

        if (priorityColorValue === "high"){
            item.classList.add("yellowColor");
        }
        if (priorityColorValue === "low"){
            item.classList.add("blueColor");
        }
        if (priorityColorValue === "normal"){
            item.classList.add("darkBlueColor");
        }
        if (priorityColorValue === "urgent"){
            item.classList.add("redColor");
        }
    })



    const updateButton = document.getElementById("updateProject");
    const updateModal = document.getElementById("updateModalContainer");
    const updateClose = document.getElementById("updateClose");
    const updateCancel = document.getElementById("updateCancel");
    const updateSave = document.getElementById("updateSave");
    const rowUpdateButton =  document.getElementById("updateButton");
    const rowUpdateButtons = document.querySelectorAll(".projectUpdate");

    rowUpdateButtons.forEach(button => {
        button.addEventListener("click", function (event) {
            event.stopPropagation();
            updateModal.style.display = "block";
            const employeeProjectID = button.getAttribute("data-employee-project-id")

            const priority = button.getAttribute("data-priority")
            const description = button.getAttribute("data-description")
            const progress = button.getAttribute("data-progress")
            const projectName = button.getAttribute("data-project-name")

            const nameInput = document.querySelector("#project-name-input")
            const prioritInput = document.querySelector("#priority-input")
            const descriptionInput = document.querySelector("#description-input")
            const progressInput = document.querySelector("#progress-input")

            const form = document.querySelector("form#update-modal")

            form.action = `/employee/projects/update/${employeeProjectID}?redirection_uri=/employee/projects?status=all`
            form.method = "post"

            nameInput.value = projectName
            prioritInput.value = priority
            descriptionInput.value = description
            progressInput.value = progress
            
        })
    });
    updateClose.onclick = function () {
        updateModal.style.display = "none";
    };
    updateCancel.onclick = function () {
        updateModal.style.display = "none";
    };
    updateSave.onclick = function () {
        updateModal.style.display = "none";
    };
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
    var table = document.getElementById('meetingTable');
    var rows = table.getElementsByTagName('tr');
    var rowsPerPage = 11;
    var currentPage = 0;
    function showPage(page) {
        var start = page * rowsPerPage;
        var end = start + rowsPerPage;
        for (var i = 0; i < rows.length; i++) {
            if (i >= start && i < end) {
                rows[i].style.display = '';
            } else {
                rows[i].style.display = 'none';
            }
        }
    }
    function createPagination() {
        var pageCount = Math.ceil(rows.length / rowsPerPage);
        var pagination = document.getElementById('pagination');
        pagination.innerHTML = '';
        for (var i = 0; i < pageCount; i++) {
            var button = document.createElement('button');
            button.innerText = i + 1;
            button.addEventListener('click', function() {
                currentPage = parseInt(this.innerText) - 1;
                showPage(currentPage);
            });
            pagination.appendChild(button);
        }
    }
    function updatePagination() {
        var buttons = document.querySelectorAll('.pagination button');
        buttons.forEach(function(btn) {
            btn.classList.remove('active');
        });
        buttons[currentPage].classList.add('active');
    }
    createPagination();
    showPage(currentPage);
    var prevBtn = document.getElementById('prevBtn');
    var nextBtn = document.getElementById('nextBtn');
    prevBtn.addEventListener('click', function() {
        if (currentPage > 0) {
            currentPage--;
            showPage(currentPage);
            updatePagination();
        }
    });
    nextBtn.addEventListener('click', function() {
        if (currentPage < Math.ceil(rows.length / rowsPerPage) - 1) {
            currentPage++;
            showPage(currentPage);
            updatePagination();
        }
    });
});

</script>
{% endblock %}
